plugins {
    id 'com.github.johnrengelman.shadow' version '1.2.4'
}

apply plugin: 'java'
apply plugin: 'application'

sourceCompatibility = '1.7'
targetCompatibility = '1.7'

[compileJava, compileTestJava]*.options*.encoding = 'UTF-8'

mainClassName = 'com.enterprisesolutions.EnterpriseSolutionsApplication'

repositories {
    mavenCentral()
}

def dependencyVersions = [
    goCardless: '2.9.0',
    dropwizard: '1.1.0'
]

dependencies {
    compile group: "com.gocardless", name: "gocardless-pro", version: dependencyVersions.goCardless

    compile group: "io.dropwizard", name: "dropwizard-core", version: dependencyVersions.dropwizard
    compile group: "io.dropwizard", name: "dropwizard-assets", version: dependencyVersions.dropwizard
    compile group: "io.dropwizard", name: "dropwizard-views-freemarker", version: dependencyVersions.dropwizard

    testCompile group: "io.dropwizard", name: "dropwizard-testing", version: dependencyVersions.dropwizard
    testCompile "org.mockito:mockito-core:1.+"
}

shadowJar {
    mergeServiceFiles()
    exclude 'META-INF/*.DSA'
    exclude 'META-INF/*.RSA'
}

jar {
    manifest {
        attributes 'Main-Class': mainClassName
    }
}

run {
    args ['server']
}

task stage(dependsOn: ['clean', 'jar'])
